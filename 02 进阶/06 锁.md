# 概述
> 锁是计算机协调多个进程或者线程并发访问某一资源的机制。

# 分类
1. 全局锁：锁定数据库中所有表
2. 表级锁：每次操作锁住整张表
3. 行级锁：每次操作锁住对应行数据

# 全局锁
> 加锁后整个实例处于只读状态 增删改 处于阻塞状态
> 典型应用场景，做全库的逻辑备份，对全表进行锁定

## 全局锁语法
1. 加锁
   ```SQL
        flush tables with read lock;
   ```

2. 解锁
   ```SQL
       unlock tables;
   ```

# 表级锁
> 每次锁住整张表，锁定粒度大，发生锁冲突的概率最高，并发度最低

## 表级锁分类
1. 表锁
2. 元数据锁（Meta data lock， MDL）
3. 意向锁
   
## 表锁
1. 表共享读锁（read lock）
2. 表独占写锁（write lock）

## 语法
1. 加锁
   ```SQL
        lock tables 表名... read/write;
   ```

2. 解锁
   ```SQL
       unlock tables; 或客户端断开连接
   ```

## 元数据锁
> 系统自动控制，无需显示使用  
> 为避免DML 与 DDL 冲突，保证读写正确性

## 意向锁
> 为避免 DML 执行时，加的行锁与表锁冲突，意向锁使得表锁不用检查每行数据是否加锁。


# 行级锁
> 每次锁住的是行数据，锁粒度最小，发生冲突概率最低，并发度最高  
> 行锁通过对索引上的索引项加锁来实现

## 行级分类
1. 行锁 （record lock） 锁定单个行记录的锁，防止其他事务 update 和 delete
2. 间隙锁 （gap lock） 锁定索引记录间隙（不含此记录），确保索引记录间隙不变，方式其他事务在这个间隙insert，产生幻读
3. 临键锁（next-key lock）行锁与间隙锁的组合，同时锁住数据并且锁住数据前面的间隙 Gap

## 行锁类型
1. 共享锁（S）：允许一个事务去读一行，阻止其他事务获取相同数据集的排他锁
2. 排他锁（X）: 允许获取排他锁事务更新数据，阻止其他事务获取相同数据集的共享锁和排他锁